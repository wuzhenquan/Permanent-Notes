<html>
  <body>
    <button id="replay">播放录像</button>
  </body>
  <script>
    const RyuReceiver = {
      attack: function () {
        console.log("攻击");
      },
      defense: function () {
        console.log("防御");
      },
      jump: function () {
        console.log("跳跃");
      },
      crouch: function () {
        console.log("蹲下");
      },
    };

    const commands = {
      119: "jump", // W
      115: "crouch", // S
      97: "defense", // A
      100: "attack", // D
    };

    const MakeCommand = function (receiver, state) {
      return () => receiver[state]();
    };

    const commandStack = []; // 保存命令堆栈

    document.onkeypress = (e) => {
      const keyCode = e.keyCode;
      const command = new MakeCommand(Ryu, commands[keyCode]);
      if (command) {
        command(); // 执行命令
        commandStack.push(command); // 将刚刚执行桌的命令保存进堆栈
      }
    };

    // 重播
    document.getElementById("replay").onclick = function () {
      let command;
      while ((command = commandStack.shift())) {
        // 从堆栈里依次取出执行命令并执行
        command();
      }
    };
  </script>
</html>
